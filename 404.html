<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" type="image/png" href="https://emgithub.com/favicon.png" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/postscribe@2.0.8/dist/postscribe.min.js"></script>
    <title>Embed Like Gist</title>
    <style>
        /* Fixed sidebar */
        html {
            overflow-y: scroll;
        }

        /* Remove validation icon for small device */
        @media (max-width: 767.98px) {

            .form-control.is-valid,
            .form-control.is-invalid {
                background-image: none;
            }
        }
    </style>
    <script>
        $(function () {
            // Initialize popovers
            $('[data-toggle="popover"]').popover();
            $("#goForm").on("submit", function (e) {
                e.preventDefault();
                const target = $("#target").val();
                const pattern = /^(https|http):\/\/github\.com(\/[A-Za-z0-9_\-\.]+){2}\/(tree|blob)\/[A-Za-z0-9_\-\.]+\//;
                if (pattern.test(target)) {
                    $("#target").removeClass("is-invalid");
                    $("#target").addClass("is-valid");
                    const jsURL = `${window.location.protocol}//${window.location.host}/embed.js?${$(this).serialize()}`;
                    const scriptTag = `<script src=\"${jsURL}\"><\/script>`;
                    $("#embededCode").val(scriptTag);
                    document.getElementById("previewArea").innerHTML = "";
                    postscribe("#previewArea", scriptTag);
                } else {
                    $("#target").removeClass("is-valid");
                    $("#target").addClass("is-invalid");
                }
            });


            $("#copyButton").on("click", function (e) {
                e.preventDefault();
                copyTextToClipboard($("#embededCode").val());
            });

            if (["/", "/index.html", "/index.htm"].includes(window.location.pathname)) {
                // Is entering the site directly
                $("#target").attr("placeholder", "https://github.com/user/repository/blob/branch/src/hello.cpp");
            } else {
                // 404 triggered. Fill in target and simulate clicking
                $("#target").val("https://github.com" + window.location.pathname);
                $("#goForm").submit();
            }

        });

        // https://stackoverflow.com/questions/400212/how-do-i-copy-to-the-clipboard-in-javascript
        function copyTextToClipboard(text) {
            if (!navigator.clipboard) {
                fallbackCopyTextToClipboard(text);
                return;
            }
            navigator.clipboard.writeText(text).then(function () {
                console.log('Async: Copying to clipboard was successful!');
            }, function (err) {
                console.error('Async: Could not copy text: ', err);
            });
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; //avoid scrolling to bottom
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                const msg = successful ? 'successful' : 'unsuccessful';
                console.log('Fallback: Copying text command was ' + msg);
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            document.body.removeChild(textArea);
        }

    </script>
</head>

<body>
    <main role="main" class="container pt-3">
        <div class="jumbotron">
            <h1>Embed Like Gist</h1>
            <p class="lead">Embed a file from Github repository just like <a target="_blank"
                    href="https://gist.github.com/">Github Gist</a>.<br>Paste URL of the file you would like to embed.
                You can also simply add "em" before
                "github.com" in address bar. If you find this helpful, consider <a target="_blank"
                    href="https://github.com/yusanshi/embed_like_gist">giving me a Star</a>.</p>
            <form id="goForm" class="mb-4">
                <div class="input-group input-group-lg mb-3">
                    <input type="text" name="target" id="target" class="form-control" required>
                    <select id="style" name="style" class="custom-select col-3 col-md-2">
                        <option value="a11y-dark">a11y-dark</option>
                        <option value="a11y-light">a11y-light</option>
                        <option value="agate">agate</option>
                        <option value="an-old-hope">an-old-hope</option>
                        <option value="androidstudio">androidstudio</option>
                        <option value="arduino-light">arduino-light</option>
                        <option value="arta">arta</option>
                        <option value="ascetic">ascetic</option>
                        <option value="atelier-cave-dark">atelier-cave-dark</option>
                        <option value="atelier-cave-light">atelier-cave-light</option>
                        <option value="atelier-dune-dark">atelier-dune-dark</option>
                        <option value="atelier-dune-light">atelier-dune-light</option>
                        <option value="atelier-estuary-dark">atelier-estuary-dark</option>
                        <option value="atelier-estuary-light">atelier-estuary-light</option>
                        <option value="atelier-forest-dark">atelier-forest-dark</option>
                        <option value="atelier-forest-light">atelier-forest-light</option>
                        <option value="atelier-heath-dark">atelier-heath-dark</option>
                        <option value="atelier-heath-light">atelier-heath-light</option>
                        <option value="atelier-lakeside-dark">atelier-lakeside-dark</option>
                        <option value="atelier-lakeside-light">atelier-lakeside-light</option>
                        <option value="atelier-plateau-dark">atelier-plateau-dark</option>
                        <option value="atelier-plateau-light">atelier-plateau-light</option>
                        <option value="atelier-savanna-dark">atelier-savanna-dark</option>
                        <option value="atelier-savanna-light">atelier-savanna-light</option>
                        <option value="atelier-seaside-dark">atelier-seaside-dark</option>
                        <option value="atelier-seaside-light">atelier-seaside-light</option>
                        <option value="atelier-sulphurpool-dark">atelier-sulphurpool-dark</option>
                        <option value="atelier-sulphurpool-light">atelier-sulphurpool-light</option>
                        <option value="atom-one-dark">atom-one-dark</option>
                        <option value="atom-one-dark-reasonable">atom-one-dark-reasonable</option>
                        <option value="atom-one-light">atom-one-light</option>
                        <option value="codepen-embed">codepen-embed</option>
                        <option value="color-brewer">color-brewer</option>
                        <option value="darcula">darcula</option>
                        <option value="dark">dark</option>
                        <option value="darkula">darkula</option>
                        <option value="default" selected>default</option>
                        <option value="docco">docco</option>
                        <option value="dracula">dracula</option>
                        <option value="far">far</option>
                        <option value="foundation">foundation</option>
                        <option value="github">github</option>
                        <option value="github-gist">github-gist</option>
                        <option value="gml">gml</option>
                        <option value="googlecode">googlecode</option>
                        <option value="gradient-dark">gradient-dark</option>
                        <option value="grayscale">grayscale</option>
                        <option value="gruvbox-dark">gruvbox-dark</option>
                        <option value="gruvbox-light">gruvbox-light</option>
                        <option value="hopscotch">hopscotch</option>
                        <option value="hybrid">hybrid</option>
                        <option value="idea">idea</option>
                        <option value="ir-black">ir-black</option>
                        <option value="isbl-editor-dark">isbl-editor-dark</option>
                        <option value="isbl-editor-light">isbl-editor-light</option>
                        <option value="kimbie.dark">kimbie.dark</option>
                        <option value="kimbie.light">kimbie.light</option>
                        <option value="lightfair">lightfair</option>
                        <option value="magula">magula</option>
                        <option value="mono-blue">mono-blue</option>
                        <option value="monokai">monokai</option>
                        <option value="monokai-sublime">monokai-sublime</option>
                        <option value="night-owl">night-owl</option>
                        <option value="nord">nord</option>
                        <option value="obsidian">obsidian</option>
                        <option value="ocean">ocean</option>
                        <option value="paraiso-dark">paraiso-dark</option>
                        <option value="paraiso-light">paraiso-light</option>
                        <option value="purebasic">purebasic</option>
                        <option value="qtcreator_dark">qtcreator_dark</option>
                        <option value="qtcreator_light">qtcreator_light</option>
                        <option value="railscasts">railscasts</option>
                        <option value="rainbow">rainbow</option>
                        <option value="routeros">routeros</option>
                        <option value="shades-of-purple">shades-of-purple</option>
                        <option value="solarized-dark">solarized-dark</option>
                        <option value="solarized-light">solarized-light</option>
                        <option value="sunburst">sunburst</option>
                        <option value="tomorrow">tomorrow</option>
                        <option value="tomorrow-night">tomorrow-night</option>
                        <option value="tomorrow-night-blue">tomorrow-night-blue</option>
                        <option value="tomorrow-night-bright">tomorrow-night-bright</option>
                        <option value="tomorrow-night-eighties">tomorrow-night-eighties</option>
                        <option value="vs">vs</option>
                        <option value="vs2015">vs2015</option>
                        <option value="xcode">xcode</option>
                        <option value="xt256">xt256</option>
                        <option value="zenburn">zenburn</option>
                    </select>
                    <div class="input-group-append">
                        <button class="btn btn-lg btn-primary" type="submit">Go</button>
                    </div>
                    <div class="invalid-feedback mt-2">Invalid URL.</div>
                </div>
                <div class="custom-control custom-checkbox custom-control-inline">
                    <input type="checkbox" class="custom-control-input" name="showBorder" id="showBorder" checked>
                    <label class="custom-control-label" for="showBorder">Border</label>
                </div>
                <div class="custom-control custom-checkbox custom-control-inline">
                    <input type="checkbox" class="custom-control-input" name="showLineNumbers" id="showLineNumbers"
                        checked>
                    <label class="custom-control-label" for="showLineNumbers">Line numbers</label>
                </div>
                <div class="custom-control custom-checkbox custom-control-inline">
                    <input type="checkbox" class="custom-control-input" name="showFileMeta" id="showFileMeta" checked>
                    <label class="custom-control-label" for="showFileMeta">File metadata</label>
                </div>
            </form>
            <label for="embededCode">Code to embed</label>
            <div class="input-group input-group-lg mb-3">
                <input type="text" id="embededCode" class="form-control" onclick="this.select();">
                <div class="input-group-append">
                    <!-- Not use <button> here, see https://getbootstrap.com/docs/4.4/components/popovers/#dismiss-on-next-click -->
                    <a tabindex="0" class="btn btn-lg btn-outline-secondary" id="copyButton" role="button"
                        data-toggle="popover" data-trigger="focus" data-placement="bottom"
                        data-content="Copied!">Copy</a>
                </div>
            </div>
            <label for="previewArea">Preview</label>
            <div id="previewArea" class="py-1"><img class="mx-auto d-block m-3" height="64" width="64"
                    src="https://emgithub.com/preview.svg"></div>
        </div>
    </main>
</body>

</html>